package lexeme

import (
	"fmt"

	"github.com/jsightapi/jsight-schema-core/bytes"
	"github.com/jsightapi/jsight-schema-core/fs"
)

// LexEvent the flow of lexical events is generated by the scanner.
// Events can be used to build tokens, or for other analysis of the structure of
// the scanned document.
type LexEvent struct {
	// A file containing the contents of the json and the file name.
	file *fs.File

	// lexEventType a type of found lexical event.
	lexEventType LexEventType

	// begin an index of the start character of the found lexical event in the
	// byte slice.
	begin bytes.Index

	// end an index of the end character of the found lexical event in the byte
	// slice.
	end bytes.Index
}

func NewLexEvent(t LexEventType, begin, end bytes.Index, file *fs.File) LexEvent {
	return LexEvent{
		file:         file,
		lexEventType: t,
		begin:        begin,
		end:          end,
	}
}

func (lex LexEvent) Value() bytes.Bytes {
	return lex.file.Content().Sub(lex.begin, lex.end+1)
}

func (lex LexEvent) File() *fs.File {
	return lex.file
}

func (lex LexEvent) Type() LexEventType {
	return lex.lexEventType
}

func (lex LexEvent) Begin() bytes.Index {
	return lex.begin
}

func (lex LexEvent) End() bytes.Index {
	return lex.end
}

func (lex LexEvent) String() string {
	return fmt.Sprintf("%s [%d:%d]", lex.lexEventType.String(), lex.begin, lex.end)
}
